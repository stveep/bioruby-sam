require 'helper'
class MutationArrayTest < Test::Unit::TestCase
  def test_hgvs
		sub_del_ins = Bio::DB::Alignment.new "OR1FQ:00021:00043	0	ENST00000366794	936	70	128M1D16M1I38M	*	0	0	ACTCATCTTCAACAAGCAGCAAGTGCCTTCTGGGGAGTCGGCGATCTTGGACCGAGTAGCCGATGGCATGGTGTTCGGTGCCCTCCTTCCCTGCGAGGAATGCTCGGGTCAGCTGGTCTTCAAGAGCGTGCCTATTACTGCACTGGGGGACGTCACTGCCTGGACCAAGTGTATGGTCAAGAC	CCCCCCCDB@?=<B7;;<<<A7?@FCDDABBCCD;C???BAB?@@?CAC@CC>??C@;;;7;;;/8/000+.;;8/@7<;;;1;;7;7;;1>BBCCDAD;???;;;C:;;C;;;?@@BC=;;7;;<00...)-55357DC<<6;;;;;,66;;;;;;6606606<:@@;5;44--)--.)---	PG:Z:novoalign	AS:i:121	UQ:i:121	NM:i:3	MD:Z:60T67^A54"
		# Using MutationArray collection method:
		assert_equal "ENST00000366794:c.[996T>C;1064delA;1080_1081insG]", sub_del_ins.mutations.to_hgvs("c")
  end

  def test_complex
    omg = Bio::DB::Alignment.new("OR1FQ:00049:00017\t0\tENST00000366794\t936\t70\t145M1I49M1I2M4D6M1I90M24D41M4S\t*\t0\t0\tACTCATCTTCAACAAGCAGCAAGTGCCTTCTGGGGAGTCGGCGATCTTGGACCGAGTAGCCGATGGCATGGTGTTCGGTGCCCTCCTTCCCTGCGAGGAATGCTCGGGTCAGCTGGTCTTCAAGAGCGATGCCTATTACTGCACTGGGGGACGTCACTGCCTGGACCAAGTGTATGGTCAAGACACAGACACCCAGACAGGAGTGGGGTAACCCCAAAGGAATTCCGAGAAATCTCTTACCTCAAGAAATTGAAGGTTAAAAAGCAGGACCGTATATTCCCCCCAGAAACCAGCGCCTCCACAGCCTCGGCTCCTGCTGCTGTGAACTCCTCTGCTGAGG\tC;;;@;;;7<<766>AAA<<66=A;>7;?B;;;;/;@C;;7;;;;;;>B@;><;@@@CCC@CCBB6;;<;7;;;7<<7<CDD?EE@@>?C=??@CCCACACCCCCCC<?;;@B;;7;;;7;@7;;CD??A?A?B<?=@CDBDAA;;;;;.;;;;;;;;;D7;;66<056;B;;;;;6;;;7;;;;;;;@A;;;0;BB;;:5::::::.:D6;;;.;;0;0;0><;2;C;;;0;@;;>ACC@?;;@:::/;7;B?B@C7;;;;-;@BB@BC?;;;;<<7<CCCC/C<?>;?ACA@AC@;;7;;B;;7;;;@DEC>@????CCCCCC?@;;6>>>DCFC@@=\tPG:Z:novoalign\tAS:i:509\tUQ:i:509\tNM:i:33\tMD:Z:60T135^CGGA64A31^CCTCCGTGGCGGCCACGCCTCCGC41")
    assert_equal "ENST00000366794:c.[852T>C;936_937insG;985_986insG;988_991delCGGA;997_998insG;1056A>G;1088_1111delCCTCCGTGGCGGCCACGCCTCCGC]",
                omg.mutations(1,nil,145).to_hgvs
  end

  def test_vep
    skip_unless_ensembl_available do
      del = Bio::DB::Alignment.new "MLF7W:00035:00652\t0\tENST00000366794\t361\t70\t141M3D68M8S\t*\t0\t0\tGGGTTCTCTGAGCTTCGGTGGGATGACCAGCAGAAAGTCAAGAAGACAGCGGAAGCTGGAGGAGTGACAGGCAAAGGCCAGGATGGAATTGGTAGCAAGGCAGAGAAGACTCTGGGTGACTTTGCAGCAGAGTATGCCAAGAACAGAAGTACGTGCAAGGGGTGTATGGAGAAGATAGAAAAGGGCCAGGTGCGCCTGTCCAAGAAGATGGCTGAGG\tEE?E?@@CCBB??>@CCACCC?CBCAA<?ACDCDE?CD@.)-/8/--;;;A6;=???DADD@BACCCDCCACCC?CACA>?>?CC@CAC@C@CCCBC@CACCCBCC@??>CCBBC=B@ACCC?CCCDDCCCCCCADDAD<??BCCCCADDCCDCDCCACCC:CCCCCCACCC@ACA:::::.:C;CACCACCDDB>BCCC@CACCA???CACCCCC@\tPG:Z:novoalign\tAS:i:135\tUQ:i:135\tNM:i:3\tMD:Z:141^TCC68"
      assert_equal "TCC/-", del.mutations(1,nil,145).vep[0]["allele_string"]
    end
  end
end
